language: python

# We add python path to enable testing jupyter notebooks
install:
  - pip install -r requirements.txt
  - pip install -r requirements-test.txt
  - export PYTHONPATH=$PWD

env:
  - MPLBACKEND=Agg

cache: pip

# command to run tests
script:
  - python -m pytest --cov=ark --pycodestyle ark

jobs:
  include:
    - stage: deploy
      deploy:
        provider: pypi
        user: "__token__"
        password: pypi-AgEIcHlwaS5vcmcCJDU0MzA3NmY3LWQwYzQtNDNkMS1hYmVjLWJjMjBjZmEzNTAzZgACPXsicGVybWlzc2lvbnMiOiB7InByb2plY3RzIjogWyJhcmstYW5hbHlzaXMiXX0sICJ2ZXJzaW9uIjogMX0AAAYgVux2VCFYzuyGrTxlsSoubcxfoxM8rK1uUXujMm0EM5k
        on:
          branch: pypi_setup
        skip_cleanup: true

after_success:
  - coveralls
